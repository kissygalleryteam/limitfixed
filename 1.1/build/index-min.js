/*!build time : 2014-04-24 12:28:37 AM*/
KISSY.add("gallery/limitfixed/1.1/index",function(a,b,c){function d(b,c){this.$fixed=g(b),this.cfg=a.merge(n,c)}function e(a){if(!a)return!1;var b=a.getDOMNode?a.getDOMNode():a;return 9===b.nodeType}var f=c.all,g=c.one,h=a.UA,i=g(document),j=g(window),k=6===h.ie,l=a.isUndefined,m="limitfixed-sticky",n={direction:"y",type:k?"absolute":"fixed",elLimit:i};a.augment(d,b.Target,{render:function(){if(!this.rendered){var a=this.cfg,b=this.$fixed;this._originOffset=b.offset(),this._originStyles={position:null,top:null,bottom:null,left:null};for(var c in this._originStyles)this._originStyles.hasOwnProperty(c)&&(this._originStyles[c]=b.css(c));a.holder&&(this._placeholder=this._buildPlaceholder()),this.rendered=!0,this.adjust()}},adjust:function(){this.restore(),this.scroll()},restore:function(){this.$fixed.css(this._originStyles),this._originOffset=this.$fixed.offset()},scroll:function(){var a,b=(this.cfg,this.$fixed),c=b.data(m);a=this._calPosition(),a?(this._showPlaceholder(),c||(b.data(m,!0),this.fire("fixed",{fixed:!0}))):(this._hidePlaceholder(),c&&(b.data(m,!1),this.fire("fixed",{fixed:!1})))},_calPosition:function(){var b=this.cfg,c=b.direction.toLowerCase(),d=this.$fixed,e=this._getLimitRange(),f=this._originOffset,g={},h=f.left,j=f.top,k=i.scrollTop(),m=i.scrollLeft();-1!==c.indexOf("y")&&(k>e.top&&k<e.bottom-d.outerHeight()?g.top=k:k>e.bottom-d.outerHeight()&&k<e.bottom&&(g.top=e.bottom-d.outerHeight())),-1!==c.indexOf("x")&&(m>e.left&&m<e.right-d.outerWidth()?g.left=m:m>e.right-d.outerWidth()&&m<e.right&&(g.left=e.right-d.outerWidth())),-1!==c.indexOf("y")&&!l(g.top)&&l(g.left)&&(g.left=h),-1!==c.indexOf("x")&&!l(g.left)&&l(g.top)&&(g.top=j);var n=this._getRelateOffset();return l(n.top)||l(g.top)||(g.top-=n.top),l(n.left)||l(g.left)||(g.left-=n.left),l(g.top)&&l(g.left)?(d.css(this._originStyles),!1):(d.css(a.mix({position:b.type},g)),!0)},_getRelateOffset:function(){var a=this.cfg,b={},c=i.scrollTop(),d=i.scrollLeft();if("fixed"==a.type)b={left:d,top:c};else if("absolute"==a.type){var e=this._getRelateElement();e&&(b=this._getOffset(e))}return b},_getRelateElement:function(){return this.$fixed.parent(function(b){return a.inArray(f(b).css("position"),["relative","absolute"])})},_getLimitRange:function(){var a=this.cfg,b=a.range,c=g(a.elLimit);return!b&&c&&(b=this._getOffset(c),b.bottom=b.top+c.outerHeight(),b.right=b.left+c.outerWidth()),b},_getOffset:function(a){return e(a)?{left:0,top:0}:a.offset()},_buildPlaceholder:function(){var a=this.cfg,b=a.placeholder;if(!b){var c=this.$fixed;b=f('<div style="visibility:hidden;margin:0;padding:0;"></div>'),b.width(c.outerWidth()).height(c.outerHeight()).css("float",c.css("float")).insertAfter(c)}return b},_showPlaceholder:function(){this._placeholder&&this._placeholder.show()},_hidePlaceholder:function(){this._placeholder&&this._placeholder.hide()}});var o=[];return a.ready(function(){j.on("scroll resize",function(b){var c=b.type,d="scroll"===c?"scroll":"adjust";a.each(o,function(a){a.rendered&&a[d]()})})}),function(a,b){var c=new d(a,b);return o.push(c),c}},{requires:["event","node"]});