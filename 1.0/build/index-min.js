/*! limitfixed - v1.0 - 2013-08-17 8:31:36 PM
* Copyright (c) 2013 wuake; Licensed  */
KISSY.add("gallery/limitfixed/1.0/index",function(a,b,c){var d,e,f,g,h,i,j,k;return h=document,f=a.UA,j=6===f.ie,g={align:["top","left"],offset:[0,0],holder:!1,holderCls:"limitfixed-holder",forceAbs:!1,cache:!1},d=function(){return this.init.apply(this,arguments)},a.augment(d,a.EventTarget,{init:function(c,d,e){return this.cfg=a.merge(g,e),this.elFixed=b.get(c),this.elLimit=b.get(d),this.isFixed=!1,this._fixedType=j?!1:!this.cfg.forceAbs,this._limitRange,this.cfg.holder&&this._buildHolder(),this.scroll()},_buildHolder:function(){var a,c;return a=this.cfg.holderCls||"",c=b.create("<div class='"+a+"'></div>"),b.height(c,b.outerHeight(this.elFixed)),b.width(c,b.outerWidth(this.elFixed)),b.insertBefore(c,this.elFixed),this.on("fixed",function(a){var d;return d=a.isFixed,d?b.show(c):b.hide(c)})},scroll:function(){var a,b,c,d;return d=this.getViewRange(),a=this.getLimitRange(),c=this._getCrossRange(d,a),null===c?this._setFixed(!1):(b=this._getAbsPosition(c,a),this._fixedType&&b.top>a.top&&parseInt(c.top)===parseInt(b.top)&&b.left>a.left&&parseInt(c.left)===parseInt(b.left)&&this.isFixed&&this.fixedRange?b=null:this.fixedRange=b=this._calPosition(b,c,a,d),this._setFixed(!0)),this._applyStyle(b)},getViewRange:function(){var a,c,d,e;return c=b.scrollLeft(h),d=b.scrollTop(h),e=b.viewportWidth(),a=b.viewportHeight(),{left:c,top:d,width:e,height:a}},getLimitRange:function(a){return this._limitRange&&!a&&this.cfg.cache||(this._limitRange=this._getRange(this.elLimit)),this._limitRange},_getRange:function(a){var c;return c=b.offset(a),{left:c.left,top:c.top,width:b.outerWidth(a),height:b.outerHeight(a)}},_getCrossRange:function(a,b){var c,d,e,f,g;return d=Math.max(a.left,b.left),f=Math.max(a.top,b.top),e=Math.min(a.left+a.width,b.left+b.width),g=Math.min(a.top+a.height,b.top+b.height),c=d>e||f>g?null:{left:d,top:f,width:e-d,height:g-f}},_getUnionRange:function(a,b){var c,d,e,f;return c=Math.min(a.left,b.left),e=Math.min(a.top,b.top),d=Math.max(a.left+a.width,b.left+b.width),f=Math.max(a.top+a.height,b.top+b.height),{left:c,top:e,width:d-c,height:f-e}},_setFixed:function(a){return a!==this.isFixed?(this.isFixed=a,this.fire("fixed",{isFixed:a})):void 0},_getAbsPosition:function(a,c){var d,e,f,g,h,i,j,k,l;return d=this._getAlign(),e=b.outerHeight(this.elFixed),f=b.outerWidth(this.elFixed),i=c.left+c.width,h=c.top+c.height,k=a.left+a.width,j=a.top+a.height,d.topFixed?l=Math.min(a.top,h-e):d.bottomFixed?l=Math.max(j-e,c.top):d.topStatic?l=Math.min(a.top,c.top):d.bottomStatic&&(l=Math.max(j-e,h-e)),d.leftFixed?g=Math.min(a.left,i-f):d.rightFixed?g=Math.max(k-f,c.left):d.leftStatic?g=Math.min(a.left,c.left):d.rightStatic&&(g=Math.max(k-f,i-f)),{left:g,top:l}},_calPosition:function(c,d,e,f){var g,h,i;return this._fixedType?h={left:f.left,top:f.top}:(i=b.parent(this.elLimit,function(c){return a.inArray(b.css(c,"position"),["relative","absolute"])}),h={left:0,top:0},i?h=b.offset(i):b.contains(this.elLimit,this.elFixed)&&a.inArray(b.css(this.elLimit,"position"),["relative","absolute"])&&(h=b.offset(this.elLimit))),c.left-=h.left,c.top-=h.top,g=this._getOffset(),c.left+=g.left||0,c.top+=g.top||0,c},_getOffset:function(){var a,b;return a=this.cfg.offset,b={left:1*a[0]||0,top:1*a[1]||0}},_getAlign:function(){var b,c,d,e;return c=a.makeArray(this.cfg.align),e=(c[1]||"").split(" "),d=c[0],b={},-1!==d.indexOf("left")&&(b.leftFixed=!0),-1!==d.indexOf("right")&&(b.rightFixed=!0),-1!==d.indexOf("top")&&(b.topFixed=!0),-1!==d.indexOf("bottom")&&(b.bottomFixed=!0),-1!==e.indexOf("left")&&(b.leftStatic=!0),-1!==e.indexOf("right")&&(b.rightStatic=!0),-1!==e.indexOf("top")&&(b.topStatic=!0),-1!==e.indexOf("bottom")&&(b.bottomStatic=!0),b},_applyStyle:function(c){var d;return d=this.isFixed?{position:this._fixedType?"fixed":"absolute"}:{position:"static"},b.css(this.elFixed,a.mix(d,c))}}),e=function(b){var d=this;this.def=b,this.collection=[],c.on(window,"scroll resize",function(){return a.each(d.collection,function(a){return a.scroll()})})},a.augment(e,{add:function(b,c,e){var f;return!e&&a.isPlainObject(c)&&(e=c,c=a.UA.chrome?h.body:h.documentElement),b&&c?(e=a.merge(this.def,e),f=new d(b,c,e),this.collection.push(f),f):void 0}}),k=new e,i=function(a,b,c){return k.add(a,b,c)}},{requires:["dom","event"]});